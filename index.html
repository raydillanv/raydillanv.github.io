<!DOCTYPE html>
<html>
<head>
  <title>Password Required</title>
</head>
<body>
  <h1>Please enter a password. W</h1>
	
  <form>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password">
    <button type="submit" id="submit">Submit</button>
  </form>
 <p> <br> For questions email: raydillanv1@gmail.com </p>
  <meta name="color-scheme" content="dark light">
  <img src="lockScreen.jpg" alt="preview" width="200" height="295"><br>
  <script>
    const passwordForm = document.querySelector('form');
    const submitButton = document.querySelector('#submit');
    
    function getPasswordHash(password) {
      return window.crypto.subtle.digest('SHA-1', new TextEncoder().encode(password))
        .then(hash => {
          return Array.from(new Uint8Array(hash))
            .map(b => b.toString(16).padStart(2, '0')).join('');
        });
    }

    function checkPassword(event) {
      event.preventDefault();
      
      const passwordInput = document.querySelector('#password');
      const password = passwordInput.value;
      getPasswordHash(password)
        .then(passwordHash => {
          return fetch('limit.html')
            .then(response => response.text())
            .then(text => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(text, 'text/html');
              const expectedHash = htmlDoc.querySelector('#passwordHash')?.textContent;
              if (passwordHash === expectedHash) {
                window.location.href = 'webpage.html';
              } else {
                const errorElement = document.createElement('p');
                errorElement.textContent = `The password is incorrect. ${expectedHash ? '' : 'Hash: '}${passwordHash}`;
                const existingError = document.querySelector('#error');
                if (existingError) {
                  existingError.replaceWith(errorElement);
                } else {
                  passwordForm.appendChild(errorElement);
                }
              }
            });
        })
        .catch(error => {
          console.error(error);
          const errorElement = document.createElement('p');
          errorElement.textContent = `An error occurred. ${error.message}`;
          const existingError = document.querySelector('#error');
          if (existingError) {
            existingError.replaceWith(errorElement);
          } else {
            passwordForm.appendChild(errorElement);
          }
        });
    }

    submitButton.addEventListener('click', checkPassword);
  </script>
</body>
</html>
